<div class="container mx-auto max-w-2xl p-4">
    <!-- Chat messages container -->
    <div id="chat-messages" class="flex flex-col space-y-4 mb-4 h-[70vh] overflow-y-auto p-4 bg-gray-50 rounded-lg">
        <!-- Messages will be inserted here -->
    </div>

    <!-- Chat input form -->
    <form hx-post="https://msciab.openserverless.dev/api/my/chat/stateless"
          hx-target="#chat-messages"
          hx-swap="beforeend"
          class="flex gap-2">
        <input 
            type="text" 
            name="text" 
            placeholder="Type your message..."
            class="flex-1 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            required>
        <button 
            type="submit"
            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
            Send
        </button>
    </form>
</div>


<!-- Template for messages -->
<template id="message-template">
    <div class="message-wrapper">
        <div class="max-w-[80%] p-3 rounded-lg mb-2">
            <p class="text-sm"></p>
        </div>
    </div>
</template>

<script>
    document.body.addEventListener('htmx:afterRequest', function(evt) {
        if (evt.detail.successful) {
            const form = evt.detail.elt;
            const input = form.querySelector('input[name="text"]');
            
            // Add user message
            const userTemplate = document.querySelector('#message-template').content.cloneNode(true);
            const userWrapper = userTemplate.querySelector('.message-wrapper');
            const userMessage = userTemplate.querySelector('p');
            userWrapper.classList.add('flex', 'justify-end');
            userMessage.parentElement.classList.add('bg-blue-100');
            userMessage.textContent = input.value;
            document.querySelector('#chat-messages').appendChild(userTemplate);
            
            // Add AI response
            const aiTemplate = document.querySelector('#message-template').content.cloneNode(true);
            const aiWrapper = aiTemplate.querySelector('.message-wrapper');
            const aiMessage = aiTemplate.querySelector('p');
            aiWrapper.classList.add('flex', 'justify-start');
            aiMessage.parentElement.classList.add('bg-gray-200');
            aiMessage.textContent = evt.detail.xhr.response;
            document.querySelector('#chat-messages').appendChild(aiTemplate);
            
            // Clear input and scroll to bottom
            input.value = '';
            const chatMessages = document.querySelector('#chat-messages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    });
</script>
